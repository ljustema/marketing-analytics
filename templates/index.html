<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Analytics Dashboard - ROAS & POAS Optimization</title>
    <link rel="icon" type="image/svg+xml" href="favicon.ico">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Annotation Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="src/styles.css">
    <!-- POAS Analytics CSS -->
    <link rel="stylesheet" href="analytics/poas-analytics.css">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <header class="dashboard-header py-3 mb-2">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="h2 mb-0">
                        <i class="fas fa-chart-line me-3"></i>
                        Marketing Analytics Dashboard
                    </h1>
                    <p class="text-muted mb-0">ROAS & POAS Optimization Tool</p>
                </div>
                <div class="col-md-4 text-end">
                    <!-- User Menu -->
                    <div class="dropdown d-inline-block me-2">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" id="userMenu" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-2"></i><span id="currentUsername">Anv√§ndare</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><h6 class="dropdown-header">Inloggad som: <span id="userMenuName">-</span></h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logga ut
                            </a></li>
                        </ul>
                    </div>

                    <button class="btn btn-outline-light me-2" onclick="toggleDarkMode()" id="themeToggle">
                        <i class="fas fa-moon me-2"></i>M√∂rkt L√§ge
                    </button>
                    <button class="btn btn-outline-light me-2" onclick="exportData()">
                        <i class="fas fa-download me-2"></i>Exportera Data
                    </button>
                </div>
            </div>

            <!-- Mobile Hamburger Menu Toggle -->
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu" id="mobileMenu" onclick="closeMobileMenu()">
            <div class="mobile-menu-content" onclick="event.stopPropagation()">
                <div class="mobile-menu-header">
                    <h5 class="mb-0">Menu</h5>
                    <button class="mobile-menu-close" onclick="closeMobileMenu()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="mobile-menu-section">
                    <h3>Navigation</h3>
                    <a href="#" class="mobile-menu-item active" onclick="switchTab('analytics'); closeMobileMenu();">
                        <i class="fas fa-chart-area me-2"></i>Analytics Dashboard
                    </a>
                    <a href="#" class="mobile-menu-item" onclick="switchTab('data-manager'); closeMobileMenu();">
                        <i class="fas fa-database me-2"></i>Data Manager
                    </a>
                    <a href="#" class="mobile-menu-item" onclick="switchTab('formulas'); closeMobileMenu();">
                        <i class="fas fa-calculator me-2"></i>Formler
                    </a>
                    <a href="#" class="mobile-menu-item" onclick="switchTab('simulator'); closeMobileMenu();">
                        <i class="fas fa-calculator me-2"></i>POAS Simulator <span class="badge bg-warning text-dark ms-1">BETA</span>
                    </a>
                    <a href="#" class="mobile-menu-item" onclick="switchTab('predictive-analytics'); closeMobileMenu();">
                        <i class="fas fa-brain me-2"></i>Prediktiv Analys <span class="badge bg-warning text-dark ms-1">BETA</span>
                    </a>
                </div>

                <div class="mobile-menu-section">
                    <h3>Actions</h3>
                    <button class="mobile-menu-item" onclick="toggleDarkMode(); closeMobileMenu();">
                        <i class="fas fa-moon me-2"></i><span id="mobileThemeText">M√∂rkt L√§ge</span>
                    </button>
                    <button class="mobile-menu-item" onclick="exportData(); closeMobileMenu();">
                        <i class="fas fa-download me-2"></i>Exportera Data
                    </button>
                    <button class="mobile-menu-item" onclick="logout(); closeMobileMenu();">
                        <i class="fas fa-sign-out-alt me-2"></i>Logga ut
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs dashboard-tabs mb-4" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                    <i class="fas fa-chart-area me-2"></i>Analytics Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="data-manager-tab" data-bs-toggle="tab" data-bs-target="#data-manager" type="button" role="tab">
                    <i class="fas fa-database me-2"></i>Data Manager
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="formulas-tab" data-bs-toggle="tab" data-bs-target="#formulas" type="button" role="tab">
                    <i class="fas fa-calculator me-2"></i>Formler
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="simulator-tab" data-bs-toggle="tab" data-bs-target="#simulator" type="button" role="tab">
                    <i class="fas fa-calculator me-2"></i>POAS Simulator <span class="badge bg-warning text-dark ms-1">BETA</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="predictive-analytics-tab" data-bs-toggle="tab" data-bs-target="#predictive-analytics" type="button" role="tab">
                    <i class="fas fa-brain me-2"></i>Prediktiv Analys <span class="badge bg-warning text-dark ms-1">BETA</span>
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="dashboardTabContent">
            <!-- Analytics Dashboard Tab -->
            <div class="tab-pane fade show active" id="analytics" role="tabpanel">
                <!-- Main Chart Section - At Top -->
                <div class="main-chart-section mb-4">
                    <div class="row">
                        <div class="col-12">
                            <div class="card chart-card main-chart">
                                <div class="card-header">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h5 class="card-title mb-0">
                                                <i class="fas fa-chart-line me-2"></i>Huvud√∂versikt - Alla Metriker
                                            </h5>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold mb-1">üìÖ Analysperiod:</label>
                                            <select class="form-select form-select-sm" id="analysisPeriod">
                                                <option value="all">Sedan start</option>
                                                <option value="currentYear">Hittills detta √•ret</option>
                                                <option value="lastYear">F√∂rra √•ret</option>
                                                <option value="last3Months">Senaste 3 m√•naderna</option>
                                                <option value="last6Months">Senaste 6 m√•naderna</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body" style="height: 650px;">
                                    <div class="chart-controls mb-3">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-primary">üìä Nyckeltal:</label>
                                                <div class="d-flex flex-column gap-1">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showROAS" checked>
                                                        <label class="form-check-label" for="showROAS">ROAS</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showPOAS" checked>
                                                        <label class="form-check-label" for="showPOAS">POAS</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showMarketingShareOfGrossprofit">
                                                        <label class="form-check-label" for="showMarketingShareOfGrossprofit">Marknadsf√∂ringens andel av bruttovinsten (%)</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showNetProfitPerAdCrown">
                                                        <label class="form-check-label" for="showNetProfitPerAdCrown">Nettovinst per annonskrona</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-warning">üìà Procent:</label>
                                                <div class="d-flex flex-column gap-1">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showgrossMarginPercent">
                                                        <label class="form-check-label" for="showgrossMarginPercent">Bruttovinst % (Utan marknadsf√∂ring)</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showNetProfitPercent">
                                                        <label class="form-check-label" for="showNetProfitPercent">Nettovinst % (Med marknadsf√∂ring)</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showMarketingPercent">
                                                        <label class="form-check-label" for="showMarketingPercent">Marknadsf√∂ring %</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showLostMargin">
                                                        <label class="form-check-label" for="showLostMargin">F√∂rlorad marginal (%)</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-success">üí∞ Belopp (SEK):</label>
                                                <div class="d-flex flex-column gap-1">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showrevenue">
                                                        <label class="form-check-label" for="showrevenue">Oms√§ttning SEK</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showgrossprofit">
                                                        <label class="form-check-label" for="showgrossprofit">Bruttovinst SEK</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showMarknadsf√∂ring">
                                                        <label class="form-check-label" for="showMarknadsf√∂ring">Marknadsf√∂ring SEK</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="showNettovinst">
                                                        <label class="form-check-label" for="showNettovinst">Nettovinst SEK</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="main-chart-container">
                                        <canvas id="trendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Metric Cards - Horizontal Layout -->
                <div class="row mb-2">
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-bullseye metric-icon text-primary"></i>
                                <h6 class="card-title mb-1">Genomsnittlig ROAS</h6>
                                <h4 class="metric-value mb-1" id="avgROAS">-</h4>
                                <small class="text-muted d-block mb-1" id="roasExplanation">Medel ROAS per m√•nad</small>
                                <small class="text-info" id="roasComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-coins metric-icon text-success"></i>
                                <h6 class="card-title mb-1">Genomsnittlig POAS</h6>
                                <h4 class="metric-value mb-1" id="avgPOAS">-</h4>
                                <small class="text-muted d-block mb-1" id="poasExplanation">Medel POAS per m√•nad</small>
                                <small class="text-info" id="poasComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-percentage metric-icon text-warning"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Bruttovinst %</h6>
                                <h4 class="metric-value mb-1" id="avggrossMarginPercent">-</h4>
                                <small class="text-muted d-block mb-1" id="grossMarginPercentExplanation">Medel bruttovinst % per m√•nad</small>
                                <small class="text-info" id="grossMarginPercentComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-chart-line metric-icon text-danger"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Nettovinst %</h6>
                                <h4 class="metric-value mb-1" id="avgNetProfitPercent">-</h4>
                                <small class="text-muted d-block mb-1" id="netProfitPercentExplanation">Medel nettovinst % per m√•nad</small>
                                <small class="text-info" id="netProfitPercentComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-chart-pie metric-icon text-info"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Marknadsf√∂ring %</h6>
                                <h4 class="metric-value mb-1" id="avgMarketingPercent">-</h4>
                                <small class="text-muted d-block mb-1" id="marketingPercentExplanation">Medel marknadsf√∂ring % per m√•nad</small>
                                <small class="text-info" id="marketingPercentComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-money-bill-wave metric-icon text-success"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Nettovinst</h6>
                                <h4 class="metric-value mb-1" id="avgNetProfit">-</h4>
                                <small class="text-muted d-block mb-1" id="netProfitExplanation">Medel nettovinst per m√•nad i SEK</small>
                                <small class="text-info" id="netProfitComparison">-</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Second Row of Metric Cards -->
                <div class="row mb-4">
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-chart-line metric-icon text-primary"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Oms√§ttning</h6>
                                <h4 class="metric-value mb-1" id="avgRevenue">-</h4>
                                <small class="text-muted d-block mb-1" id="revenueExplanation">Medel f√∂rs√§ljning per m√•nad i SEK</small>
                                <small class="text-info" id="revenueComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-coins metric-icon text-success"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Bruttovinst</h6>
                                <h4 class="metric-value mb-1" id="avgGrossprofit">-</h4>
                                <small class="text-muted d-block mb-1" id="grossprofitExplanation">Medel bruttovinst per m√•nad i SEK</small>
                                <small class="text-info" id="grossprofitComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-bullhorn metric-icon text-warning"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Marknadsf√∂ring</h6>
                                <h4 class="metric-value mb-1" id="avgMarketingSpend">-</h4>
                                <small class="text-muted d-block mb-1" id="marketingSpendExplanation">Medel marknadsf√∂ringskostnad per m√•nad i SEK</small>
                                <small class="text-info" id="marketingSpendComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-exclamation-triangle metric-icon text-danger"></i>
                                <h6 class="card-title mb-1">Genomsnittlig F√∂rlorad marginal</h6>
                                <h4 class="metric-value mb-1" id="avgLostMargin">-</h4>
                                <small class="text-muted d-block mb-1" id="lostMarginExplanation">Medel f√∂rlorad marginal % per m√•nad</small>
                                <small class="text-info" id="lostMarginComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-percentage metric-icon text-purple"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Marknadsf√∂ringens andel av bruttovinsten</h6>
                                <h4 class="metric-value mb-1" id="avgMarketingShareOfGrossprofit">-</h4>
                                <small class="text-muted d-block mb-1" id="marketingShareOfGrossprofitExplanation">Medel marknadsf√∂ringens andel av bruttovinsten % per m√•nad</small>
                                <small class="text-info" id="marketingShareOfGrossprofitComparison">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card metric-card h-100">
                            <div class="card-body text-center py-3">
                                <i class="fas fa-chart-line metric-icon text-info"></i>
                                <h6 class="card-title mb-1">Genomsnittlig Nettovinst per annonskrona</h6>
                                <h4 class="metric-value mb-1" id="avgNetProfitPerAdCrown">-</h4>
                                <small class="text-muted d-block mb-1" id="netProfitPerAdCrownExplanation">Medel nettovinst per annonskrona per m√•nad</small>
                                <small class="text-info" id="netProfitPerAdCrownComparison">-</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Individual Metric Charts -->
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-bullseye me-2"></i>ROAS Trend
                                </h5>
                                <small class="text-muted">Return on Ad Spend: Oms√§ttning SEK √∑ Marknadsf√∂ring SEK</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="roasChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-coins me-2"></i>POAS Trend
                                </h5>
                                <small class="text-muted">Profit on Ad Spend: Bruttovinst SEK √∑ Marknadsf√∂ring SEK</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="poasChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-percentage me-2"></i>Bruttovinst % (Utan marknadsf√∂ring)
                                </h5>
                                <small class="text-muted">Bruttovinst %: (Bruttovinst SEK √∑ Oms√§ttning SEK) √ó 100</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="grossMarginPercentChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-chart-line me-2"></i>Nettovinst % (Med marknadsf√∂ring)
                                </h5>
                                <small class="text-muted">Nettovinst %: ((Bruttovinst SEK - Marknadsf√∂ring SEK) √∑ Oms√§ttning SEK) √ó 100</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="netProfitPercentChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-money-bill-wave me-2"></i>Bruttovinst SEK (Utan marknadsf√∂ring)
                                </h5>
                                <small class="text-muted">Oms√§ttning - Varukostnad - Fraktkostnad - Betalnings och Packningskostnader i SEK</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="grossprofitChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-money-bill-wave me-2"></i>Nettovinst SEK (Med marknadsf√∂ring)
                                </h5>
                                <small class="text-muted">Bruttovinst SEK - Marknadsf√∂ring SEK</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="nettovinstChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-chart-pie me-2"></i>Marknadsf√∂ring %
                                </h5>
                                <small class="text-muted">Marknadsf√∂ring %: (Marknadsf√∂ring SEK √∑ Oms√§ttning SEK) √ó 100</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="marketingPercentChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-bullhorn me-2"></i>Marknadsf√∂ring SEK
                                </h5>
                                <small class="text-muted">Total kostnad f√∂r marknadsf√∂ring i SEK</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="marketingSpendChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-chart-line me-2"></i>Oms√§ttning SEK
                                </h5>
                                <small class="text-muted">Total f√∂rs√§ljning i SEK</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-arrow-trend-down me-2"></i>F√∂rlorad marginal (ROAS ‚Äì POAS %)
                                </h5>
                                <small class="text-muted">((ROAS ‚Äì POAS) √∑ ROAS) √ó 100<br>Visar hur stor andel av int√§kterna som f√∂rsvinner i varukostnad, frakt, packning och andra direkta kostnader ‚Äì allts√• skillnaden mellan oms√§ttningen och den verkliga bruttovinsten per annonskrona. L√§gre v√§rde √§r b√§ttre.</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="lostMarginChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-percentage me-2"></i>Marknadsf√∂ringens andel av bruttovinsten
                                </h5>
                                <small class="text-muted">(Marknadsf√∂ring SEK √∑ Bruttovinst SEK) √ó 100<br>Visar hur stor andel av bruttovinsten som f√∂rbrukas av marknadsf√∂ring varje m√•nad. Ett h√∂gt v√§rde inneb√§r att en st√∂rre del av din vinst g√•r √•t till annonsering.</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="marketingShareOfGrossprofitChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="card chart-card metric-chart">
                            <div class="card-header pb-2">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-chart-line me-2"></i>Nettovinst per annonskrona
                                </h5>
                                <small class="text-muted">Nettovinst SEK √∑ Marknadsf√∂ring SEK<br>Visar hur mycket nettovinst du f√•r per satsad marknadsf√∂ringskrona ‚Äì direkt m√•tt p√• l√∂nsamhet.</small>
                            </div>
                            <div class="card-body pt-2">
                                <canvas id="netProfitPerAdCrownChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Manager Tab -->
            <div class="tab-pane fade" id="data-manager" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-plus me-2"></i>L√§gg till M√•nadsdata
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="dataForm">
                                    <div class="mb-3">
                                        <label for="monthInput" class="form-label">M√•nad</label>
                                        <input type="month" class="form-control" id="monthInput" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="revenueInput" class="form-label">Oms√§ttning (SEK)</label>
                                        <input type="number" class="form-control" id="revenueInput" min="0" step="0.01" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="grossprofitInput" class="form-label">Bruttovinst (SEK)</label>
                                        <input type="number" class="form-control" id="grossprofitInput" min="0" step="0.01" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="marketingSpendInput" class="form-label">Marknadsf√∂ring (SEK)</label>
                                        <input type="number" class="form-control" id="marketingSpendInput" min="0" step="0.01" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="fas fa-save me-2"></i>Spara Data
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- CSV Import/Export Section -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-file-csv me-2"></i>CSV Import/Export
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <button type="button" class="btn btn-outline-primary w-100 mb-2" onclick="downloadCSVTemplate()">
                                        <i class="fas fa-download me-2"></i>Ladda ner CSV-mall
                                    </button>
                                    <small class="text-muted d-block mb-3">Ladda ner en CSV-mall med exempeldata som du kan redigera och ladda upp igen.</small>
                                </div>

                                <div class="mb-3">
                                    <label for="csvFileInput" class="form-label">Ladda upp CSV-fil</label>
                                    <input type="file" class="form-control mb-2" id="csvFileInput" accept=".csv">
                                    <button type="button" class="btn btn-success w-100" id="csvUploadButton" onclick="handleCSVUpload()" disabled>
                                        <i class="fas fa-upload me-2"></i>Ladda upp CSV
                                    </button>
                                    <small class="text-muted d-block mt-2">V√§lj en CSV-fil med kolumnerna: month, revenue, grossprofit, marketingSpend</small>
                                </div>

                                <div id="csvUploadStatus" class="alert" style="display: none;"></div>

                                <hr class="my-3">

                                <button type="button" class="btn btn-outline-danger w-100" onclick="clearAllData()">
                                    <i class="fas fa-trash me-2"></i>Rensa All Data
                                </button>
                                <small class="text-muted d-block mt-2">Varning: Detta tar bort all m√•nadsdata permanent.</small>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-sliders-h me-2"></i>Tr√∂skelv√§rden
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="thresholdForm">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">ROAS Tr√∂skelv√§rden</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="roasThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="roasThresholdLow" min="0" step="0.1" value="1.5">
                                            </div>
                                            <div class="col-6">
                                                <label for="roasThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="roasThresholdHigh" min="0" step="0.1" value="2.0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">POAS Tr√∂skelv√§rden</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="poasThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="poasThresholdLow" min="0" step="0.1" value="1.0">
                                            </div>
                                            <div class="col-6">
                                                <label for="poasThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="poasThresholdHigh" min="0" step="0.1" value="1.5">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Bruttovinst Tr√∂skelv√§rden (%)</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="grossMarginPercentThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="grossMarginPercentThresholdLow" min="0" max="100" step="1" value="15">
                                            </div>
                                            <div class="col-6">
                                                <label for="grossMarginPercentThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="grossMarginPercentThresholdHigh" min="0" max="100" step="1" value="20">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nettovinst % Tr√∂skelv√§rden</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="netProfitPercentThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="netProfitPercentThresholdLow" min="0" max="100" step="1" value="5">
                                            </div>
                                            <div class="col-6">
                                                <label for="netProfitPercentThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="netProfitPercentThresholdHigh" min="0" max="100" step="1" value="10">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Marknadsf√∂ring % Tr√∂skelv√§rden</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="marketingPercentThresholdLow" class="form-label text-muted">L√•g (bra)</label>
                                                <input type="number" class="form-control" id="marketingPercentThresholdLow" min="0" max="100" step="1" value="10">
                                            </div>
                                            <div class="col-6">
                                                <label for="marketingPercentThresholdHigh" class="form-label text-muted">H√∂g (varning)</label>
                                                <input type="number" class="form-control" id="marketingPercentThresholdHigh" min="0" max="100" step="1" value="15">
                                            </div>
                                        </div>
                                    </div>

                                    <hr class="my-4">
                                    <h6 class="text-muted mb-3">Int√§ktstr√∂sklar (SEK)</h6>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Oms√§ttning Tr√∂skelv√§rden (SEK)</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="revenueThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="revenueThresholdLow" min="0" step="1000" value="50000">
                                            </div>
                                            <div class="col-6">
                                                <label for="revenueThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="revenueThresholdHigh" min="0" step="1000" value="100000">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Bruttovinst Tr√∂skelv√§rden (SEK)</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="grossprofitThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="grossprofitThresholdLow" min="0" step="1000" value="25000">
                                            </div>
                                            <div class="col-6">
                                                <label for="grossprofitThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="grossprofitThresholdHigh" min="0" step="1000" value="50000">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Marknadsf√∂ring Tr√∂skelv√§rden (SEK)</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="marketingSpendThresholdLow" class="form-label text-muted">L√•g (bra)</label>
                                                <input type="number" class="form-control" id="marketingSpendThresholdLow" min="0" step="1000" value="10000">
                                            </div>
                                            <div class="col-6">
                                                <label for="marketingSpendThresholdHigh" class="form-label text-muted">H√∂g (varning)</label>
                                                <input type="number" class="form-control" id="marketingSpendThresholdHigh" min="0" step="1000" value="25000">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nettovinst Tr√∂skelv√§rden (SEK)</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="nettovinstThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="nettovinstThresholdLow" min="0" step="1000" value="15000">
                                            </div>
                                            <div class="col-6">
                                                <label for="nettovinstThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="nettovinstThresholdHigh" min="0" step="1000" value="30000">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">F√∂rlorad marginal Tr√∂skelv√§rden (%)</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="lostMarginThresholdLow" class="form-label text-muted">L√•g (bra)</label>
                                                <input type="number" class="form-control" id="lostMarginThresholdLow" min="0" max="100" step="1" value="70">
                                            </div>
                                            <div class="col-6">
                                                <label for="lostMarginThresholdHigh" class="form-label text-muted">H√∂g (varning)</label>
                                                <input type="number" class="form-control" id="lostMarginThresholdHigh" min="0" max="100" step="1" value="80">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Marknadsf√∂ringens andel av bruttovinsten Tr√∂skelv√§rden (%)</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="marketingShareOfGrossprofitThresholdLow" class="form-label text-muted">L√•g (bra)</label>
                                                <input type="number" class="form-control" id="marketingShareOfGrossprofitThresholdLow" min="0" max="100" step="1" value="30">
                                            </div>
                                            <div class="col-6">
                                                <label for="marketingShareOfGrossprofitThresholdHigh" class="form-label text-muted">H√∂g (varning)</label>
                                                <input type="number" class="form-control" id="marketingShareOfGrossprofitThresholdHigh" min="0" max="100" step="1" value="50">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nettovinst per annonskrona Tr√∂skelv√§rden</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="netProfitPerAdCrownThresholdLow" class="form-label text-muted">L√•g (varning)</label>
                                                <input type="number" class="form-control" id="netProfitPerAdCrownThresholdLow" min="0" step="0.1" value="0.5">
                                            </div>
                                            <div class="col-6">
                                                <label for="netProfitPerAdCrownThresholdHigh" class="form-label text-muted">H√∂g (bra)</label>
                                                <input type="number" class="form-control" id="netProfitPerAdCrownThresholdHigh" min="0" step="0.1" value="1.0">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-secondary w-100">
                                        <i class="fas fa-check me-2"></i>Uppdatera Tr√∂skelv√§rden
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-table me-2"></i>M√•nadsdata √ñversikt
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped" id="dataTable">
                                        <thead>
                                            <tr>
                                                <th>M√•nad</th>
                                                <th>Oms√§ttning</th>
                                                <th>Bruttovinst</th>
                                                <th>Marknadsf√∂ring</th>
                                                <th>ROAS</th>
                                                <th>POAS</th>
                                                <th>Bruttovinst %</th>
                                                <th>Marknadsf√∂ring %</th>
                                                <th>√Ötg√§rder</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                                <div id="noDataMessage" class="text-center text-muted py-4" style="display: none;">
                                    <i class="fas fa-inbox fa-3x mb-3"></i>
                                    <h5>Ingen data tillg√§nglig</h5>
                                    <p>L√§gg till m√•nadsdata f√∂r att se ber√§kningar och analyser.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- POAS Simulator Tab -->
            <div class="tab-pane fade" id="simulator" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-calculator me-2"></i>Simulator Inst√§llningar
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="simulatorForm">
                                    <div class="mb-3">
                                        <label for="currentrevenue" class="form-label">Nuvarande Oms√§ttning (SEK)</label>
                                        <input type="number" class="form-control" id="currentrevenue" min="0" step="0.01">
                                    </div>
                                    <div class="mb-3">
                                        <label for="currentgrossprofit" class="form-label">Nuvarande Bruttovinst (SEK)</label>
                                        <input type="number" class="form-control" id="currentgrossprofit" min="0" step="0.01">
                                    </div>
                                    <div class="mb-3">
                                        <label for="currentMarknadsf√∂ring" class="form-label">Nuvarande Marknadsf√∂ring (SEK)</label>
                                        <input type="number" class="form-control" id="currentMarknadsf√∂ring" min="0" step="0.01">
                                    </div>
                                    <hr>
                                    <div class="mb-3">
                                        <label for="targetROAS" class="form-label">M√•l ROAS</label>
                                        <input type="number" class="form-control" id="targetROAS" min="0" step="0.1" value="3.0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="targetPOAS" class="form-label">M√•l POAS</label>
                                        <input type="number" class="form-control" id="targetPOAS" min="0" step="0.1" value="2.0">
                                    </div>
                                    <button type="button" class="btn btn-primary w-100" onclick="runSimulation()">
                                        <i class="fas fa-play me-2"></i>K√∂r Simulering
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-chart-bar me-2"></i>Simuleringsresultat
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="simulationResults" style="display: none;">
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <h6 class="card-title">Rekommenderad Marknadsf√∂ring (ROAS)</h6>
                                                    <h4 class="text-primary" id="recommendedMarketingROAS">-</h4>
                                                    <small class="text-muted">F√∂r att uppn√• m√•l ROAS</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <h6 class="card-title">Rekommenderad Marknadsf√∂ring (POAS)</h6>
                                                    <h4 class="text-success" id="recommendedMarketingPOAS">-</h4>
                                                    <small class="text-muted">F√∂r att uppn√• m√•l POAS</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <canvas id="simulationChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div id="simulationPlaceholder" class="text-center text-muted py-5">
                                    <i class="fas fa-chart-line fa-3x mb-3"></i>
                                    <h5>Simuleringsresultat</h5>
                                    <p>Fyll i nuvarande data och m√•lv√§rden, klicka sedan p√• "K√∂r Simulering" f√∂r att se rekommendationer.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Predictive Analytics Tab -->
            <div class="tab-pane fade" id="predictive-analytics" role="tabpanel">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-brain me-2"></i>POAS Prediktiv Analys
                                </h5>
                                <p class="text-muted mb-0">Avancerad analys f√∂r att svara: "F√•r vi mer nettovinst i SEK om vi s√§nker POAS lite?"</p>
                            </div>
                            <div class="card-body">
                                <!-- Analytics Status -->
                                <div id="analyticsStatus" class="alert alert-info">
                                    <i class="fas fa-spinner fa-spin me-2"></i>Initialiserar analysmotor...
                                </div>

                                <!-- Quick Analysis Summary -->
                                <div id="quickAnalysis" class="mb-4" style="display: none;">
                                    <div class="row g-3">
                                        <div class="col-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center py-2">
                                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">Historisk Data</h6>
                                                    <h4 id="totalMonths" class="text-primary mb-1">-</h4>
                                                    <small class="text-muted">m√•nader analyserade</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center py-2">
                                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">Nuvarande Snitt POAS</h6>
                                                    <h4 id="currentAvgPOAS" class="text-success mb-1">-</h4>
                                                    <small class="text-muted">senaste 6 m√•naderna</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center py-2">
                                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">Optimal POAS Intervall</h6>
                                                    <h4 id="optimalPOASRange" class="text-warning mb-1">-</h4>
                                                    <small class="text-muted">h√∂gsta nettovinst</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center py-2">
                                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">POAS Trend</h6>
                                                    <h4 id="poasTrend" class="text-info mb-1">-</h4>
                                                    <small class="text-muted">riktning & styrka</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- POAS Optimizer -->
                                <div id="poasOptimizer" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="card-title mb-0">
                                                        <i class="fas fa-sliders-h me-2"></i>POAS M√•loptimering
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="poasSlider" class="form-label">M√•l POAS: <span id="poasSliderValue">3.0</span></label>
                                                        <input type="range" class="form-range" id="poasSlider" min="1.5" max="5.0" step="0.1" value="3.0">
                                                        <div class="d-flex justify-content-between">
                                                            <small class="text-muted">1.5</small>
                                                            <small class="text-muted">5.0</small>
                                                        </div>
                                                    </div>

                                                    <div class="mb-3">
                                                        <button type="button" class="btn btn-primary w-100" id="predictButton">
                                                            <i class="fas fa-magic me-2"></i>F√∂ruts√§g Nettovinst
                                                        </button>
                                                    </div>

                                                    <div id="predictionStatus" class="alert alert-secondary" style="display: none;">
                                                        <i class="fas fa-spinner fa-spin me-2"></i>Ber√§knar f√∂ruts√§gelse...
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-8">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="card-title mb-0">
                                                        <i class="fas fa-chart-line me-2"></i>F√∂ruts√§gelseresultat
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div id="predictionResults" style="display: none;">
                                                        <!-- Prediction cards will be inserted here -->
                                                    </div>
                                                    <div id="predictionPlaceholder" class="text-center text-muted py-5">
                                                        <i class="fas fa-magic fa-3x mb-3"></i>
                                                        <h5>F√∂ruts√§gelseresultat</h5>
                                                        <p>Justera POAS-m√•lreglaget och klicka p√• "F√∂ruts√§g Nettovinst" f√∂r att se avancerad analys.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Advanced Charts Section -->
                                <div id="advancedCharts" class="mt-4" style="display: none;">
                                    <div class="row">
                                        <div class="col-12 mb-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="card-title mb-0">
                                                        <i class="fas fa-chart-area me-2"></i>POAS Optimeringsanalys
                                                    </h6>
                                                </div>
                                                <div class="card-body" style="height: 400px;">
                                                    <canvas id="poasOptimizationChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="card-title mb-0">
                                                        <i class="fas fa-balance-scale me-2"></i>Scenarioj√§mf√∂relse
                                                    </h6>
                                                </div>
                                                <div class="card-body" style="height: 350px;">
                                                    <canvas id="scenarioComparisonChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="card-title mb-0">
                                                        <i class="fas fa-history me-2"></i>Historiska M√∂nster
                                                    </h6>
                                                </div>
                                                <div class="card-body" style="height: 350px;">
                                                    <canvas id="historicalPatternChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Debug Information -->
                                <div id="debugInfo" class="mt-4" style="display: none;">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="card-title mb-0">
                                                <i class="fas fa-bug me-2"></i>Debug Information
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <pre id="debugOutput" class="bg-light p-3" style="font-size: 12px; max-height: 300px; overflow-y: auto;"></pre>
                                        </div>
                                    </div>
                                </div>

                                <!-- Manual initialization button for debugging -->
                                <div class="mt-3">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="window.poasInterface.initialize()">
                                        <i class="fas fa-sync me-2"></i>Manuell initialisering (om det fastnar)
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulas Reference Tab -->
            <div class="tab-pane fade" id="formulas" role="tabpanel">
                <div class="card">
                    <div class="card-header py-2">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-calculator me-2"></i>Formelreferens
                        </h5>
                    </div>
                    <div class="card-body py-2">
                        <div class="row">
                            <!-- Column 1: üìä Nyckeltal -->
                            <div class="col-md-4">
                                <div class="formula-group">
                                    <h6 class="fw-bold text-primary mb-2">
                                        <i class="fas fa-chart-bar me-1"></i>üìä Nyckeltal
                                    </h6>
                                    <div class="formula-item mb-1">
                                        <strong>ROAS</strong><br>
                                        <code>Oms√§ttning √∑ Marknadsf√∂ring</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Oms√§ttning per marknadsf√∂ringskrona.<br>
                                        <span class="threshold-text" data-metric="roas"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>POAS</strong><br>
                                        <code>Bruttovinst √∑ Marknadsf√∂ring</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Bruttovinst per marknadsf√∂ringskrona.<br>
                                        <span class="threshold-text" data-metric="poas"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>Marknadsf√∂ringens andel av bruttovinsten (%)</strong><br>
                                        <code>(Marknadsf√∂ring √∑ Bruttovinst) √ó 100</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Hur stor del av bruttovinsten som g√•r till marknadsf√∂ring.<br>
                                        <span class="threshold-text" data-metric="marketingShareOfGrossprofit"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>Nettovinst per annonskrona</strong><br>
                                        <code>(Bruttovinst - Marknadsf√∂ring) √∑ Marknadsf√∂ring</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Nettovinst per satsad marknadsf√∂ringskrona.<br>
                                        <span class="threshold-text" data-metric="netProfitPerAdCrown"></span></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Column 2: üìà Procent -->
                            <div class="col-md-4">
                                <div class="formula-group">
                                    <h6 class="fw-bold text-warning mb-2">
                                        <i class="fas fa-percentage me-1"></i>üìà Procent
                                    </h6>
                                    <div class="formula-item mb-1">
                                        <strong>Bruttovinst % (Utan marknadsf√∂ring)</strong><br>
                                        <code>(Bruttovinst √∑ Oms√§ttning) √ó 100</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Andel av oms√§ttningen som blir bruttovinst.<br>
                                        <span class="threshold-text" data-metric="grossMarginPercent"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>Nettovinst % (Med marknadsf√∂ring)</strong><br>
                                        <code>((Bruttovinst - Marknadsf√∂ring) √∑ Oms√§ttning) √ó 100</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Andel av oms√§ttningen som blir nettovinst.<br>
                                        <span class="threshold-text" data-metric="netProfitPercent"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>Marknadsf√∂ring %</strong><br>
                                        <code>(Marknadsf√∂ring √∑ Oms√§ttning) √ó 100</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Andel av oms√§ttningen som g√•r till marknadsf√∂ring.<br>
                                        <span class="threshold-text" data-metric="marketingPercent"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>F√∂rlorad marginal (%)</strong><br>
                                        <code>((ROAS - POAS) √∑ ROAS) √ó 100</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Andel av int√§kterna som "f√∂rsvinner" i varukostnad.<br>
                                        <span class="threshold-text" data-metric="lostMargin"></span></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Column 3: üí∞ Belopp (SEK) -->
                            <div class="col-md-4">
                                <div class="formula-group">
                                    <h6 class="fw-bold text-success mb-2">
                                        <i class="fas fa-coins me-1"></i>üí∞ Belopp (SEK)
                                    </h6>
                                    <div class="formula-item mb-1">
                                        <strong>Oms√§ttning SEK</strong><br>
                                        <code>Manuell inmatning</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Total f√∂rs√§ljning f√∂r m√•naden.<br>
                                        <span class="threshold-text" data-metric="revenue"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>Bruttovinst SEK</strong><br>
                                        <code>Manuell inmatning</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Oms√§ttning minus varukostnad.<br>
                                        <span class="threshold-text" data-metric="grossprofit"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>Marknadsf√∂ring SEK</strong><br>
                                        <code>Manuell inmatning</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Total marknadsf√∂ringskostnad.<br>
                                        <span class="threshold-text" data-metric="marketingSpend"></span></small>
                                    </div>
                                    <div class="formula-item mb-1">
                                        <strong>Nettovinst SEK</strong><br>
                                        <code>Bruttovinst - Marknadsf√∂ring</code><br>
                                        <small><strong>Vad det m√§ter:</strong> Faktisk vinst efter marknadsf√∂ringskostnader.<br>
                                        <span class="threshold-text" data-metric="nettovinst"></span></small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- POAS Analytics Scripts -->
    <script src="analytics/poas-utils.js"></script>
    <script src="analytics/poas-predictor.js"></script>
    <script src="analytics/poas-analytics.js"></script>
    <script src="analytics/poas-charts.js"></script>
    <script src="analytics/poas-interface.js"></script>
    <!-- Custom JavaScript -->
    <script src="src/script.js?v=<?php echo time(); ?>-csv-fix2"></script>
</body>
</html>


